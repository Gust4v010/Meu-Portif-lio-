import requests
import pandas as pd
import json

# --- CONFIGURA√á√ÉO DA API ---
# ATEN√á√ÉO: Use a sua chave de API real aqui. 
# Ela deve ser inclu√≠da no cabe√ßalho 'X-Auth-Token'.
API_KEY = "732065ca7cc5407dbbc5d376eaac0ef3" 
BASE_URL = "https://api.football-data.org/v4"
COMPETITION_CODE = "BSA" # C√≥digo do Brasileir√£o S√©rie A
ENDPOINT = f"/competitions/{COMPETITION_CODE}/standings"

# --- Cabe√ßalhos de Autentica√ß√£o ---
headers = {
    'X-Auth-Token': API_KEY
}

def obter_tabela_brasileirao():
    """Faz a requisi√ß√£o √† API football-data.org e retorna os dados JSON."""
    url = BASE_URL + ENDPOINT
    print(f"Buscando dados em: {url}")
    
    try:
        response = requests.get(url, headers=headers)
        response.raise_for_status() # Lan√ßa exce√ß√£o para erros HTTP (4xx ou 5xx)
        
        data = response.json()
        return data
        
    except requests.exceptions.RequestException as e:
        print(f"‚ùå Erro ao acessar a API: {e}")
        # Informa sobre o status do erro (pode ser 403 Forbidden se a chave for inv√°lida ou o plano n√£o cobrir)
        if 'response' in locals() and response.status_code == 403:
            print("Verifique se sua chave (API Key) est√° correta e se o plano de acesso cobre o Brasileir√£o.")
        return None

def formatar_tabela(dados):
    """Extrai e formata a tabela de classifica√ß√£o em um DataFrame do Pandas."""
    if not dados or 'standings' not in dados:
        print("Estrutura de dados inv√°lida ou vazia.")
        return None

    # O primeiro item da lista 'standings' cont√©m a tabela geral (TOTAL)
    tabela_standings = dados['standings'][0]['table']
    
    tabela = []
    for linha in tabela_standings:
        clube = {
            'Pos': linha.get('position'),
            'Time': linha.get('team', {}).get('name'),
            'P': linha.get('points'),
            'J': linha.get('playedGames'),
            'V': linha.get('won'),
            'E': linha.get('draw'),
            'D': linha.get('lost'),
            'GP': linha.get('goalsFor'),
            'GC': linha.get('goalsAgainst'),
            'SG': linha.get('goalDifference')
        }
        tabela.append(clube)

    # Cria o DataFrame
    df = pd.DataFrame(tabela)
    # Define as colunas na ordem desejada
    df = df[['Pos', 'Time', 'P', 'J', 'V', 'E', 'D', 'GP', 'GC', 'SG']]
    return df

# --- EXECU√á√ÉO PRINCIPAL ---
if __name__ == "__main__":
    print("Iniciando busca da Tabela do Campeonato Brasileiro (football-data.org)...")
    dados_json = obter_tabela_brasileirao()

    if dados_json:
        tabela_df = formatar_tabela(dados_json)
        
        if tabela_df is not None:
            print("\nüèÜ Tabela do Campeonato Brasileiro - S√©rie A üèÜ")
            # Imprime a tabela no console sem o √≠ndice do Pandas
            print(tabela_df.to_string(index=False)) 
        else:
            print("N√£o foi poss√≠vel gerar a tabela.")
    else:
        print("Falha na obten√ß√£o dos dados da API.")
